

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>cwatm.management_modules.output &mdash; Community Water Model</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/iiasa.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> Community Water Model
          

          
            
            <img src="../../../_static/IIASA_logo_white.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                1.0.6
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../intro.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modeldesign.html">2. Model Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../publication.html">3. Publication</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../setup.html">4. Setup of the model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial.html">5. Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../errorHandling.html">6. Error handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../listVariables.html">7. List of output variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../results.html">8. Demo of the model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../todo.html">9. The Model Itself</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../data.html">10. Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../calibration.html">11. Calibration tool</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../calibration_tutorial.html">12. Calibration tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../resolution.html">13. Increasing resolution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../zambezi.html">14. Example Zambezi</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../license.html">15. License and download info</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../sourcecode.html">16. Source code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../forum.html">17. Forum</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Community Water Model</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>cwatm.management_modules.output</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for cwatm.management_modules.output</h1><div class="highlight"><pre>
<span></span><span class="c1"># -------------------------------------------------------------------------</span>
<span class="c1"># Name:        Output</span>
<span class="c1"># Purpose:     Output as timeseries, netcdf,</span>
<span class="c1">#</span>
<span class="c1"># Author:      PB</span>
<span class="c1">#</span>
<span class="c1"># Created:     5/08/2016</span>
<span class="c1"># Copyright:   (c) PB 2016</span>
<span class="c1"># -------------------------------------------------------------------------</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="nb">globals</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">difflib</span>  <span class="c1"># to check the closest word in settingsfile, if an error occurs</span>

<span class="kn">from</span> <span class="nn">cwatm.hydrological_modules.routing_reservoirs.routing_sub</span> <span class="kn">import</span> <span class="o">*</span>


<span class="kn">from</span> <span class="nn">cwatm.management_modules.checks</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">cwatm.management_modules.replace_pcr</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">cwatm.management_modules.data_handling</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">.messages</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">netCDF4</span> <span class="kn">import</span> <span class="n">Dataset</span><span class="p">,</span><span class="n">num2date</span><span class="p">,</span><span class="n">date2num</span><span class="p">,</span><span class="n">date2index</span>

<span class="kn">from</span> <span class="nn">decimal</span> <span class="kn">import</span> <span class="n">Decimal</span>

<div class="viewcode-block" id="outputTssMap"><a class="viewcode-back" href="../../../management_modules.html#cwatm.management_modules.output.outputTssMap">[docs]</a><span class="k">class</span> <span class="nc">outputTssMap</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Output of time series and map</span>


<span class="sd">    **Global variables**</span>

<span class="sd">    =====================================  ======================================================================  =====</span>
<span class="sd">    Variable [self.var]                    Description                                                             Unit </span>
<span class="sd">    =====================================  ======================================================================  =====</span>
<span class="sd">    dirUp                                  river network in upstream direction                                     --   </span>
<span class="sd">    cellArea                               Area of cell                                                            m2   </span>
<span class="sd">    sampleAdresses                                                                                                 --   </span>
<span class="sd">    noOutpoints                                                                                                    --   </span>
<span class="sd">    evalCatch                                                                                                      --   </span>
<span class="sd">    catcharea                                                                                                      --   </span>
<span class="sd">    firstout                                                                                                       --   </span>
<span class="sd">    discharge                              Channel discharge                                                       m3/s </span>
<span class="sd">    =====================================  ======================================================================  =====</span>

<span class="sd">    **Functions**</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">var</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">var</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>

<div class="viewcode-block" id="outputTssMap.initial"><a class="viewcode-back" href="../../../management_modules.html#cwatm.management_modules.output.outputTssMap.initial">[docs]</a>    <span class="k">def</span> <span class="nf">initial</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initial part of the output module</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">getlocOutpoints</span><span class="p">(</span><span class="n">out</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Get the location of output points</span>

<span class="sd">            :param out: get out</span>
<span class="sd">            :return: sampleAdresses - number and locs of the output</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="n">sampleAdresses</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">maskinfo</span><span class="p">[</span><span class="s1">&#39;mapC&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
                <span class="k">if</span> <span class="n">out</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">sampleAdresses</span><span class="p">[</span><span class="n">out</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">i</span>
            <span class="k">return</span> <span class="n">sampleAdresses</span>


        <span class="k">def</span> <span class="nf">appendinfo</span><span class="p">(</span><span class="n">out</span><span class="p">,</span><span class="n">sec</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">ismap</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Append all information on outputpoints and maps - what output, where, when</span>

<span class="sd">            :param out:  map or tss, info of variable, output location</span>
<span class="sd">            :param sec:  Section of settingsfile</span>
<span class="sd">            :param name: variable name</span>
<span class="sd">            :param type: daily or monthly or avergae monthly etc.</span>
<span class="sd">            :param ismap: if map = True , if timeserie = False</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="n">key</span> <span class="o">=</span> <span class="n">sec</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="nb">type</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">out</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">out</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;None&quot;</span><span class="p">:</span>
                    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">out</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
                        <span class="n">info</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">outDir</span><span class="p">[</span><span class="n">sec</span><span class="p">]):</span>
                            <span class="k">if</span> <span class="n">ismap</span><span class="p">:</span>
                                <span class="n">info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outDir</span><span class="p">[</span><span class="n">sec</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">var</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">type</span> <span class="o">+</span> <span class="s2">&quot;.nc&quot;</span><span class="p">))</span>
                                <span class="c1">#vars(self.var)[var+&quot;_&quot;+type] = 0</span>
                                <span class="c1"># creates a var to sum/ average the results e.g. self.var.Precipitation_monthtot</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="c1"># TimeoutputTimeseries(binding[tss], self.var, outpoints, noHeader=Flags[&#39;noheader&#39;])</span>
                                <span class="c1">#info.append(os.path.join(outDir[sec], str(var) + &quot;_daily.tss&quot;))</span>
                                <span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outDir</span><span class="p">[</span><span class="n">sec</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">var</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span><span class="o">+</span> <span class="nb">type</span> <span class="o">+</span> <span class="s2">&quot;.tss&quot;</span><span class="p">)</span>
                                <span class="c1">#info.append(TimeoutputTimeseries2(name, self.var, outpoints, noHeader=False))</span>
                                <span class="n">info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Error 220: Checking output file path </span><span class="se">\n</span><span class="s2">&quot;</span>
                            <span class="k">raise</span> <span class="n">CWATMFileError</span><span class="p">(</span><span class="n">outDir</span><span class="p">[</span><span class="n">sec</span><span class="p">],</span> <span class="n">msg</span><span class="p">)</span>
                        <span class="n">info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">ismap</span><span class="p">:</span> <span class="n">info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># flag set False for initial writing if it is a map</span>
                        <span class="k">else</span><span class="p">:</span> <span class="n">info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="ow">not</span><span class="p">(</span><span class="n">Flags</span><span class="p">[</span><span class="s1">&#39;noheader&#39;</span><span class="p">]))</span>  <span class="c1"># flag set True for writing time series header</span>

                        <span class="n">placeholder</span> <span class="o">=</span><span class="p">[]</span>
                        <span class="n">info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">placeholder</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">ismap</span><span class="p">:</span> <span class="n">info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">type</span><span class="p">)</span>  <span class="c1"># set type to create variable later on first timestep</span>
                        <span class="n">out</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">info</span>
                        <span class="n">i</span> <span class="o">+=</span><span class="mi">1</span>


        <span class="c1"># ------------------------------------------------------------------------------</span>
        <span class="c1"># if a geotif is used it can be a local map or a global</span>
        <span class="n">localGauges</span> <span class="o">=</span> <span class="n">returnBool</span><span class="p">(</span><span class="s1">&#39;GaugesLocal&#39;</span><span class="p">)</span>
        <span class="n">where</span> <span class="o">=</span> <span class="s2">&quot;Gauges&quot;</span>
        <span class="n">outpoints</span> <span class="o">=</span> <span class="n">cbinding</span><span class="p">(</span><span class="n">where</span><span class="p">)</span>

        <span class="c1">#globals.inZero = np.zeros(maskinfo[&#39;mapC&#39;])</span>

        <span class="n">coord</span> <span class="o">=</span> <span class="n">cbinding</span><span class="p">(</span><span class="n">where</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>  <span class="c1"># could be gauges, sites, lakeSites etc.</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">compress_arange</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">maskinfo</span><span class="p">[</span><span class="s1">&#39;mapC&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">arange</span> <span class="o">=</span> <span class="n">decompress</span><span class="p">(</span><span class="n">compress_arange</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

            <span class="c1">#outpoints = valuecell( coord, outpoints)</span>
            <span class="n">col</span><span class="p">,</span><span class="n">row</span> <span class="o">=</span> <span class="n">valuecell</span><span class="p">(</span><span class="n">coord</span><span class="p">,</span> <span class="n">outpoints</span><span class="p">,</span> <span class="n">returnmap</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sampleAdresses</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">col</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sampleAdresses</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">arange</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">col</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">outpoints</span><span class="p">):</span>
                <span class="n">outpoints</span> <span class="o">=</span> <span class="n">loadmap</span><span class="p">(</span><span class="n">where</span><span class="p">,</span> <span class="n">local</span> <span class="o">=</span> <span class="n">localGauges</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Error 221: Checking output-points file</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Error 129: Coordinates are not pairs</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="k">raise</span> <span class="n">CWATMFileError</span><span class="p">(</span><span class="n">outpoints</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">sname</span><span class="o">=</span><span class="s2">&quot;Gauges&quot;</span><span class="p">)</span>

            <span class="c1"># self.var.Tss[tss] = TimeoutputTimeseries(cbinding(tss), self.var, outpoints, noHeader=Flags[&#39;noheader&#39;])</span>
            <span class="n">outpoints</span><span class="p">[</span><span class="n">outpoints</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sampleAdresses</span> <span class="o">=</span> <span class="n">getlocOutpoints</span><span class="p">(</span><span class="n">outpoints</span><span class="p">)</span>  <span class="c1"># for key in sorted(mydict):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">noOutpoints</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sampleAdresses</span><span class="p">)</span>
        <span class="c1">#catch = subcatchment1(self.var.dirUp,outpoints,self.var.UpArea1)</span>

        <span class="c1"># check if catchment area calculation is necessary</span>
        <span class="n">calcCatch</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot;areaavg&quot;</span> <span class="ow">in</span> <span class="n">x</span><span class="p">,</span> <span class="n">outTss</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> <span class="n">calcCatch</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot;areasum&quot;</span> <span class="ow">in</span> <span class="n">x</span><span class="p">,</span> <span class="n">outTss</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> <span class="n">calcCatch</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">calcCatch</span><span class="p">:</span>
           <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">evalCatch</span> <span class="o">=</span><span class="p">{}</span>
           <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">catcharea</span> <span class="o">=</span> <span class="p">{}</span>


           <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sampleAdresses</span><span class="p">):</span>
              <span class="n">outp</span>  <span class="o">=</span> <span class="nb">globals</span><span class="o">.</span><span class="n">inZero</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
              <span class="n">outp</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sampleAdresses</span><span class="p">[</span><span class="n">key</span><span class="p">]]</span> <span class="o">=</span> <span class="n">key</span>



              <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">evalCatch</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">catchment1</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">dirUp</span><span class="p">,</span> <span class="n">outp</span><span class="p">)</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">catcharea</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">evalCatch</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">weights</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">cellArea</span><span class="p">)[</span><span class="n">key</span><span class="p">]</span>

        <span class="c1"># ------------------------------------------------------------------------------</span>
        <span class="k">if</span> <span class="n">checkOption</span><span class="p">(</span><span class="s1">&#39;reportTss&#39;</span><span class="p">):</span>
            <span class="c1"># loop through all the section with output variables</span>
            <span class="k">for</span> <span class="n">sec</span> <span class="ow">in</span> <span class="n">outsection</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">type2</span> <span class="ow">in</span> <span class="n">outputTypTss2</span><span class="p">:</span>
                    <span class="k">for</span> <span class="nb">type</span> <span class="ow">in</span> <span class="n">outputTypTss</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">type2</span> <span class="o">==</span> <span class="s2">&quot;tss&quot;</span><span class="p">:</span>
                            <span class="nb">type</span> <span class="o">=</span> <span class="nb">type</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="nb">type</span> <span class="o">=</span> <span class="n">type2</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">type</span>
                        <span class="n">appendinfo</span><span class="p">(</span><span class="n">outTss</span><span class="p">,</span> <span class="n">sec</span><span class="p">,</span> <span class="s2">&quot;_out_tss_&quot;</span><span class="p">,</span><span class="nb">type</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>


        <span class="k">if</span> <span class="n">checkOption</span><span class="p">(</span><span class="s1">&#39;reportMap&#39;</span><span class="p">):</span>
            <span class="c1"># load netcdf metadata from precipitation</span>
            <span class="n">metaNetCDF</span><span class="p">()</span>

            <span class="c1"># loop through all the section with output variables</span>
            <span class="k">for</span> <span class="n">sec</span> <span class="ow">in</span> <span class="n">outsection</span><span class="p">:</span>
                <span class="c1"># daily output, monthly total monthly average,</span>
                <span class="k">for</span> <span class="nb">type</span> <span class="ow">in</span> <span class="n">outputTypMap</span><span class="p">:</span>
                    <span class="c1"># map or tss, section, type = daily, monthly ....</span>
                    <span class="n">appendinfo</span><span class="p">(</span><span class="n">outMap</span><span class="p">,</span><span class="n">sec</span><span class="p">,</span> <span class="s2">&quot;_out_map_&quot;</span><span class="p">,</span><span class="nb">type</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>


        <span class="c1"># check if timing of output is in outputTypTss  (globals.py)</span>
        <span class="k">for</span> <span class="n">out</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">outTss</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">outputTypTss</span><span class="p">):</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Error 130: Output is not possible!</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="o">+</span><span class="n">out</span> <span class="o">+</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2"> is not one of these: daily, monthend, monthtot, monthavg, annualend, annualtot, annualavg&quot;</span>
                <span class="k">raise</span> <span class="n">CWATMError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="ow">in</span> <span class="n">outputTypTss2</span><span class="p">):</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Error 131: Output is not possible!</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="o">+</span><span class="n">out</span> <span class="o">+</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2"> is not one of these: TSS for point value, AreaSum for sum of area, AreaAvg for average of area&quot;</span>
                <span class="k">raise</span> <span class="n">CWATMError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span></div>




<div class="viewcode-block" id="outputTssMap.dynamic"><a class="viewcode-back" href="../../../management_modules.html#cwatm.management_modules.output.outputTssMap.dynamic">[docs]</a>    <span class="k">def</span> <span class="nf">dynamic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ef</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dynamic part of the output module</span>
<span class="sd">        Output of maps and timeseries</span>

<span class="sd">        :param ef: done with environmental flow</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">firstout</span><span class="p">(</span><span class="nb">map</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            returns the first cell as output value</span>

<span class="sd">            :param map: 1D array of data</span>
<span class="sd">            :return: value of the first output point</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="n">first</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sampleAdresses</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">map</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sampleAdresses</span><span class="p">[</span><span class="n">first</span><span class="p">]]</span>
            <span class="k">return</span> <span class="n">value</span>

        <span class="k">def</span> <span class="nf">checkifvariableexists</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">vari</span><span class="p">,</span> <span class="n">space</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Test if variable exists</span>

<span class="sd">            :param name: variable name</span>
<span class="sd">            :param vari: variable to check if it exists in the variable space</span>
<span class="sd">            :param space: variable space of self.var</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">vari</span> <span class="ow">in</span> <span class="n">space</span><span class="p">):</span>
                <span class="n">closest</span> <span class="o">=</span> <span class="n">difflib</span><span class="o">.</span><span class="n">get_close_matches</span><span class="p">(</span><span class="n">vari</span><span class="p">,</span> <span class="n">space</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">closest</span><span class="p">:</span> <span class="n">closest</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;- no match -&quot;</span><span class="p">]</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Error 132: Variable </span><span class="se">\&quot;</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">vari</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2"> is not defined in </span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="o">+</span> <span class="n">name</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\&quot;\n</span><span class="s2">&quot;</span>
                <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;Closest variable to this name is: </span><span class="se">\&quot;</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">closest</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">&quot;</span>
                <span class="k">raise</span> <span class="n">CWATMError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>



        <span class="k">def</span> <span class="nf">sample3</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="nb">map</span><span class="p">,</span> <span class="n">daymonthyear</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Collects outputpoint value to write it into a time series file</span>
<span class="sd">            calls function :meth:`management_modules.writeTssFile`</span>

<span class="sd">            :param expression: array of outputpoint information</span>
<span class="sd">            :param map: 1D array of data</span>
<span class="sd">            :param daymonthyear: day =0 , month =1 , year =2</span>
<span class="sd">            :return: expression</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="c1">#if dateVar[&#39;checked&#39;][dateVar[&#39;currwrite&#39;] - 1] &gt;= daymonthyear:</span>
            <span class="c1"># using a list with is 1 for monthend and 2 for year end to check for execution</span>
            <span class="n">value</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c1">#tss.split(&#39;_&#39;)[-2]</span>

            <span class="c1"># if inputmap is not an array give out error message</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="nb">map</span><span class="p">,</span> <span class="s1">&#39;__len__&#39;</span><span class="p">)):</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;No values in: &quot;</span> <span class="o">+</span> <span class="n">expression</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Could not write: &quot;</span> <span class="o">+</span> <span class="n">expression</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">CWATMWarning</span><span class="p">(</span><span class="n">msg</span><span class="p">))</span>
                <span class="k">return</span> <span class="n">expression</span>

            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sampleAdresses</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">expression</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;areaavg&#39;</span><span class="p">,</span><span class="s1">&#39;areasum&#39;</span><span class="p">]:</span>
                    <span class="c1"># value from catchment</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">evalCatch</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">weights</span> <span class="o">=</span> <span class="nb">map</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">cellArea</span><span class="p">)[</span><span class="n">key</span><span class="p">]</span>

                    <span class="k">if</span> <span class="n">expression</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;areaavg&#39;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">catcharea</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">v</span> <span class="o">=</span> <span class="mf">0.</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">v</span> <span class="o">=</span> <span class="n">v</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">catcharea</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span> <span class="c1"># from single cell</span>
                   <span class="n">v</span> <span class="o">=</span> <span class="nb">map</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sampleAdresses</span><span class="p">[</span><span class="n">key</span><span class="p">]]</span>
                <span class="n">value</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
            <span class="n">expression</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;laststep&#39;</span><span class="p">]:</span>
                <span class="n">writeTssFile</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="n">daymonthyear</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">expression</span>


        <span class="k">def</span> <span class="nf">writeTssFile</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="n">daymonthyear</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            writing timeseries</span>
<span class="sd">            calls function :meth:`management_modules.writeFileHeader`</span>

<span class="sd">            :param expression:  array of outputpoint information</span>
<span class="sd">            :param daymonthyear: day =0 , month =1 , year =2</span>
<span class="sd">            :return: -</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="n">outputFilename</span> <span class="o">=</span> <span class="n">expression</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">expression</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
                <span class="n">writeFileHeader</span><span class="p">(</span><span class="n">outputFilename</span><span class="p">,</span><span class="n">expression</span><span class="p">)</span>
                <span class="n">outputFile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">outputFilename</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">outputFile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">outputFilename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>

            <span class="k">assert</span> <span class="n">outputFile</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">expression</span><span class="p">[</span><span class="mi">3</span><span class="p">]):</span>
                <span class="n">numbervalues</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">expression</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>

                <span class="k">for</span> <span class="n">timestep</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;intSpin&#39;</span><span class="p">],</span> <span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;intEnd&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;checked&#39;</span><span class="p">][</span><span class="n">timestep</span> <span class="o">-</span> <span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;intSpin&#39;</span><span class="p">]]</span> <span class="o">&gt;=</span> <span class="n">daymonthyear</span><span class="p">:</span>
                    <span class="c1">#if dateVar[&#39;checked&#39;][timestep - 1] &gt;= daymonthyear:</span>
                        <span class="n">row</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                        <span class="n">row</span> <span class="o">+=</span> <span class="s2">&quot; </span><span class="si">%8g</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">timestep</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numbervalues</span><span class="p">):</span>
                            <span class="n">value</span> <span class="o">=</span> <span class="n">expression</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="n">timestep</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">):</span>
                                <span class="n">row</span> <span class="o">+=</span> <span class="s2">&quot;           1e31&quot;</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">row</span> <span class="o">+=</span> <span class="s2">&quot; </span><span class="si">%14g</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">value</span>
                        <span class="n">row</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="n">outputFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>

            <span class="n">outputFile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">writeFileHeader</span><span class="p">(</span><span class="n">outputFilename</span><span class="p">,</span><span class="n">expression</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            writes header part of tss file</span>

<span class="sd">            :param outputfilename: name of the outputfile</span>
<span class="sd">            :param expression:  array of outputpoint information</span>
<span class="sd">            :return: -</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="n">outputFile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">outputFilename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
            <span class="c1"># header</span>
            <span class="c1"># outputFile.write(&quot;timeseries &quot; + self._spatialDatatype.lower() + &quot;\n&quot;)</span>
            <span class="n">header</span> <span class="o">=</span> <span class="s2">&quot;timeseries &quot;</span> <span class="o">+</span> <span class="s2">&quot; settingsfile: &quot;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">settingsfile</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; date: &quot;</span> <span class="o">+</span> <span class="n">xtime</span><span class="o">.</span><span class="n">ctime</span><span class="p">(</span><span class="n">xtime</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
            <span class="n">header</span> <span class="o">+=</span> <span class="s2">&quot; CWATM: &quot;</span> <span class="o">+</span> <span class="n">versioning</span><span class="p">[</span><span class="s1">&#39;exe&#39;</span><span class="p">]</span>  <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span><span class="n">versioning</span><span class="p">[</span><span class="s1">&#39;lastdate&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="s1">&#39;save_git&#39;</span> <span class="ow">in</span> <span class="n">option</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">checkOption</span><span class="p">(</span><span class="s2">&quot;save_git&quot;</span><span class="p">):</span>
                    <span class="kn">import</span> <span class="nn">git</span>
                    <span class="n">header</span> <span class="o">+=</span> <span class="s2">&quot;git commit &quot;</span> <span class="o">+</span> <span class="n">git</span><span class="o">.</span><span class="n">Repo</span><span class="p">(</span><span class="n">search_parent_directories</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">hexsha</span>
           
            <span class="n">outputFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">expression</span><span class="p">[</span><span class="mi">3</span><span class="p">]):</span>
                <span class="n">numbervalues</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">expression</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span> <span class="n">numbervalues</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="n">outputFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">numbervalues</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">outputFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;timestep</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sampleAdresses</span><span class="p">):</span>
                <span class="n">outputFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">outputFile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c1"># ************************************************************</span>
        <span class="c1"># ***** WRITING RESULTS: TIME SERIES *************************</span>
        <span class="c1"># ************************************************************</span>

        <span class="c1"># xxx=catchmenttotal(self.var.SurfaceRunForest * self.var.PixelArea, self.var.Ldd) * self.var.InvUpArea</span>
        <span class="c1"># self.var.Tss[&#39;DisTS&#39;].sample(xxx)</span>
        <span class="c1"># self.report(self.Precipitation,cbinding(&#39;TaMaps&#39;))</span>


        <span class="k">def</span> <span class="nf">sample_maptotxt</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="nb">map</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Write map information to textfile</span>

<span class="sd">            :param expression:</span>
<span class="sd">            :param map:</span>
<span class="sd">            :return:</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">size</span> <span class="o">=</span> <span class="nb">map</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">outputFilename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">expression</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;.txt&quot;</span>
            <span class="n">outputFile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">outputFilename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
            <span class="n">outputFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Map_dump &quot;</span> <span class="o">+</span> <span class="s2">&quot; settingsfile: &quot;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">settingsfile</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; date: &quot;</span> <span class="o">+</span> <span class="n">xtime</span><span class="o">.</span><span class="n">ctime</span><span class="p">(</span><span class="n">xtime</span><span class="o">.</span><span class="n">time</span><span class="p">())</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">outputFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Parameter: &quot;</span> <span class="o">+</span> <span class="n">expression</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">outputFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Number of cells: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">size</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
                <span class="n">v</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%.3f</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">round</span><span class="p">(</span><span class="mf">1000.</span> <span class="o">*</span> <span class="nb">map</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">3</span><span class="p">)</span>
                <span class="n">outputFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
            <span class="n">outputFile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>









        <span class="c1"># ************************************************************</span>

        <span class="c1"># ***** WRITING RESULTS: MAPS   ******************************</span>
        <span class="c1"># ************************************************************</span>

        <span class="c1"># print &#39;----------------#&#39;</span>
        <span class="n">varname</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">varnameCollect</span> <span class="o">=</span><span class="p">[]</span>
        <span class="k">if</span> <span class="n">checkOption</span><span class="p">(</span><span class="s1">&#39;reportMap&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;curr&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;intSpin&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">ef</span><span class="p">:</span>
            <span class="k">for</span> <span class="nb">map</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">outMap</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">outMap</span><span class="p">[</span><span class="nb">map</span><span class="p">]</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()):</span>
                    <span class="k">if</span> <span class="n">outMap</span><span class="p">[</span><span class="nb">map</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;None&quot;</span><span class="p">:</span>

                        <span class="n">netfile</span> <span class="o">=</span> <span class="n">outMap</span><span class="p">[</span><span class="nb">map</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">flag</span> <span class="o">=</span> <span class="n">outMap</span><span class="p">[</span><span class="nb">map</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
                        <span class="c1"># flag to create netcdf or to write</span>
                        <span class="n">varname</span> <span class="o">=</span> <span class="n">outMap</span><span class="p">[</span><span class="nb">map</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                        <span class="nb">type</span> <span class="o">=</span> <span class="n">outMap</span><span class="p">[</span><span class="nb">map</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>

                        <span class="c1"># to use also variables with index from soil e.g. actualET[2]</span>
                        <span class="k">if</span> <span class="s1">&#39;[&#39;</span> <span class="ow">in</span> <span class="n">varname</span><span class="p">:</span>
                            <span class="n">checkname</span> <span class="o">=</span> <span class="n">varname</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">varname</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;[&quot;</span><span class="p">)]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">checkname</span> <span class="o">=</span> <span class="n">varname</span>
                        <span class="n">checkifvariableexists</span><span class="p">(</span><span class="nb">map</span><span class="p">,</span><span class="n">checkname</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>

                        <span class="n">varnameCollect</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">varname</span><span class="p">)</span>
                        <span class="n">inputmap</span> <span class="o">=</span> <span class="s1">&#39;self.var.&#39;</span> <span class="o">+</span> <span class="n">varname</span>

                        <span class="c1"># create variable after it is checked on the first timestep</span>
                        <span class="c1"># creates a var to sum/ average the results e.g. self.var.Precipitation_monthtot</span>
                        <span class="k">if</span> <span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;curr&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;intSpin&#39;</span><span class="p">]:</span>
                            <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)[</span><span class="n">varname</span><span class="o">+</span><span class="s2">&quot;_&quot;</span><span class="o">+</span><span class="nb">type</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

                        <span class="k">if</span> <span class="nb">map</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:]</span> <span class="o">==</span> <span class="s2">&quot;daily&quot;</span><span class="p">:</span>
                            <span class="n">outMap</span><span class="p">[</span><span class="nb">map</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">writenetcdf</span><span class="p">(</span><span class="n">netfile</span><span class="p">,</span> <span class="n">varname</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;undefined&quot;</span><span class="p">,</span> <span class="nb">eval</span><span class="p">(</span><span class="n">inputmap</span><span class="p">),</span>  <span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;currDate&#39;</span><span class="p">],</span><span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;currwrite&#39;</span><span class="p">],</span> <span class="n">flag</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;diffdays&#39;</span><span class="p">])</span>
                        <span class="k">if</span> <span class="nb">map</span><span class="p">[</span><span class="o">-</span><span class="mi">8</span><span class="p">:]</span> <span class="o">==</span> <span class="s2">&quot;monthend&quot;</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;checked&#39;</span><span class="p">][</span><span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;currwrite&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                                <span class="n">outMap</span><span class="p">[</span><span class="nb">map</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">writenetcdf</span><span class="p">(</span><span class="n">netfile</span><span class="p">,</span> <span class="n">varname</span><span class="p">,</span> <span class="s2">&quot;_monthend&quot;</span><span class="p">,</span> <span class="s2">&quot;undefined&quot;</span><span class="p">,</span> <span class="nb">eval</span><span class="p">(</span><span class="n">inputmap</span><span class="p">),</span>  <span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;currDate&#39;</span><span class="p">],</span> <span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;currMonth&#39;</span><span class="p">],</span> <span class="n">flag</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;diffMonth&#39;</span><span class="p">])</span>
                        <span class="k">if</span> <span class="nb">map</span><span class="p">[</span><span class="o">-</span><span class="mi">8</span><span class="p">:]</span> <span class="o">==</span> <span class="s2">&quot;monthtot&quot;</span><span class="p">:</span>
                            <span class="c1"># sum up daily value to monthly values</span>
                            <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)[</span><span class="n">varname</span> <span class="o">+</span> <span class="s2">&quot;_monthtot&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)[</span><span class="n">varname</span> <span class="o">+</span> <span class="s2">&quot;_monthtot&quot;</span><span class="p">]</span> <span class="o">+</span>  <span class="nb">eval</span><span class="p">(</span><span class="n">inputmap</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">map</span><span class="p">[</span><span class="o">-</span><span class="mi">8</span><span class="p">:]</span> <span class="o">==</span> <span class="s2">&quot;monthavg&quot;</span><span class="p">:</span>
                            <span class="c1">#vars(self.var)[varname + &quot;_monthavg&quot;] = vars(self.var)[varname + &quot;_monthavg&quot;] + vars(self.var)[varname]</span>
                            <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)[</span><span class="n">varname</span> <span class="o">+</span> <span class="s2">&quot;_monthavg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)[</span><span class="n">varname</span> <span class="o">+</span> <span class="s2">&quot;_monthavg&quot;</span><span class="p">]</span> <span class="o">+</span>  <span class="nb">eval</span><span class="p">(</span><span class="n">inputmap</span><span class="p">)</span>

                        <span class="k">if</span> <span class="nb">map</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span> <span class="o">==</span> <span class="s2">&quot;once&quot;</span><span class="p">:</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">returnBool</span><span class="p">(</span><span class="s1">&#39;calc_ef_afterRun&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;currDate&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;dateEnd&#39;</span><span class="p">]):</span>
                                <span class="c1"># either load already calculated discharge or at the end of the simulation</span>
                                <span class="n">outMap</span><span class="p">[</span><span class="nb">map</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">writenetcdf</span><span class="p">(</span><span class="n">netfile</span><span class="p">,</span> <span class="n">varname</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;undefined&quot;</span><span class="p">,</span> <span class="nb">eval</span><span class="p">(</span><span class="n">inputmap</span><span class="p">),</span>
                                                            <span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;currDate&#39;</span><span class="p">],</span> <span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;currwrite&#39;</span><span class="p">],</span> <span class="n">flag</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">map</span><span class="p">[</span><span class="o">-</span><span class="mi">7</span><span class="p">:]</span> <span class="o">==</span> <span class="s2">&quot;12month&quot;</span><span class="p">:</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">returnBool</span><span class="p">(</span><span class="s1">&#39;calc_ef_afterRun&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;currDate&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;dateEnd&#39;</span><span class="p">]):</span>
                                <span class="c1"># either load already calculated discharge or at the end of the simulation</span>
                                <span class="n">flag1</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># create new netcdf file</span>
                                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">12</span><span class="p">):</span>
                                    <span class="n">in1</span> <span class="o">=</span> <span class="n">inputmap</span>  <span class="o">+</span> <span class="s1">&#39;[&#39;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span>
                                    <span class="n">date1</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;dateEnd&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                                    <span class="n">outMap</span><span class="p">[</span><span class="nb">map</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">writenetcdf</span><span class="p">(</span><span class="n">netfile</span><span class="p">,</span> <span class="n">varname</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;undefined&quot;</span><span class="p">,</span> <span class="nb">eval</span><span class="p">(</span><span class="n">in1</span><span class="p">),</span> <span class="n">date1</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">flag1</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span><span class="mi">12</span><span class="p">)</span>
                                    <span class="n">flag1</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1"># now append to netcdf file</span>


                        <span class="c1"># if end of month is reached</span>
                        <span class="k">if</span> <span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;checked&#39;</span><span class="p">][</span><span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;currwrite&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                            <span class="c1">#if (map[-8:] == &quot;monthend&quot;):</span>
                            <span class="c1">#    outMap[map][i][2] = writenetcdf(netfile, varname,&quot;_monthend&quot;, &quot;undefined&quot;, eval(inputmap+ &quot;_monthend&quot;), #dateVar[&#39;currDate&#39;], dateVar[&#39;currMonth&#39;], flag, True,</span>
                            <span class="c1">#                                    dateVar[&#39;diffMonth&#39;],dateunit=&quot;months&quot;)</span>
                            <span class="k">if</span> <span class="nb">map</span><span class="p">[</span><span class="o">-</span><span class="mi">8</span><span class="p">:]</span> <span class="o">==</span> <span class="s2">&quot;monthtot&quot;</span><span class="p">:</span>
                                <span class="n">outMap</span><span class="p">[</span><span class="nb">map</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">writenetcdf</span><span class="p">(</span><span class="n">netfile</span><span class="p">,</span> <span class="n">varname</span><span class="p">,</span><span class="s2">&quot;_monthtot&quot;</span><span class="p">,</span> <span class="s2">&quot;undefined&quot;</span><span class="p">,</span> <span class="nb">eval</span><span class="p">(</span><span class="n">inputmap</span><span class="o">+</span> <span class="s2">&quot;_monthtot&quot;</span><span class="p">),</span> <span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;currDate&#39;</span><span class="p">],</span> <span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;currMonth&#39;</span><span class="p">],</span> <span class="n">flag</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span>
                                                                <span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;diffMonth&#39;</span><span class="p">],</span><span class="n">dateunit</span><span class="o">=</span><span class="s2">&quot;months&quot;</span><span class="p">)</span>
                                <span class="c1">#vars(self.var)[varname + &quot;monthtot&quot;] = 0</span>
                            <span class="k">if</span> <span class="nb">map</span><span class="p">[</span><span class="o">-</span><span class="mi">8</span><span class="p">:]</span> <span class="o">==</span> <span class="s2">&quot;monthavg&quot;</span><span class="p">:</span>
                                <span class="c1">#days = calendar.monthrange(dateVar[&#39;currDate&#39;].year, dateVar[&#39;currDate&#39;].month)[1]</span>
                                <span class="n">avgmap</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)[</span><span class="n">varname</span> <span class="o">+</span> <span class="s2">&quot;_monthavg&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;daysInMonth&#39;</span><span class="p">]</span>
                                <span class="n">outMap</span><span class="p">[</span><span class="nb">map</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">writenetcdf</span><span class="p">(</span><span class="n">netfile</span><span class="p">,</span> <span class="n">varname</span><span class="p">,</span><span class="s2">&quot;_monthavg&quot;</span><span class="p">,</span> <span class="s2">&quot;undefined&quot;</span><span class="p">,</span> <span class="n">avgmap</span><span class="p">,</span><span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;currDate&#39;</span><span class="p">],</span> <span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;currMonth&#39;</span><span class="p">],</span> <span class="n">flag</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span><span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;diffMonth&#39;</span><span class="p">],</span><span class="n">dateunit</span><span class="o">=</span><span class="s2">&quot;months&quot;</span><span class="p">)</span>
                                <span class="c1">#vars(self.var)[varname+&quot;monthavg&quot;] = 0</span>



                        <span class="k">if</span> <span class="nb">map</span><span class="p">[</span><span class="o">-</span><span class="mi">9</span><span class="p">:]</span> <span class="o">==</span> <span class="s2">&quot;annualend&quot;</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;checked&#39;</span><span class="p">][</span><span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;currwrite&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
                                <span class="n">outMap</span><span class="p">[</span><span class="nb">map</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">writenetcdf</span><span class="p">(</span><span class="n">netfile</span><span class="p">,</span> <span class="n">varname</span><span class="p">,</span><span class="s2">&quot;_annualend&quot;</span><span class="p">,</span> <span class="s2">&quot;undefined&quot;</span><span class="p">,</span> <span class="nb">eval</span><span class="p">(</span><span class="n">inputmap</span><span class="p">),</span>  <span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;currDate&#39;</span><span class="p">],</span> <span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;currYear&#39;</span><span class="p">],</span> <span class="n">flag</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;diffYear&#39;</span><span class="p">],</span>
                                                                <span class="n">dateunit</span><span class="o">=</span><span class="s2">&quot;years&quot;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">map</span><span class="p">[</span><span class="o">-</span><span class="mi">9</span><span class="p">:]</span> <span class="o">==</span> <span class="s2">&quot;annualtot&quot;</span><span class="p">:</span>
                            <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)[</span><span class="n">varname</span> <span class="o">+</span> <span class="s2">&quot;_annualtot&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)[</span><span class="n">varname</span> <span class="o">+</span> <span class="s2">&quot;_annualtot&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)[</span><span class="n">varname</span><span class="p">]</span>
                        <span class="k">if</span> <span class="nb">map</span><span class="p">[</span><span class="o">-</span><span class="mi">9</span><span class="p">:]</span> <span class="o">==</span> <span class="s2">&quot;annualavg&quot;</span><span class="p">:</span>
                            <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)[</span><span class="n">varname</span> <span class="o">+</span> <span class="s2">&quot;_annualavg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)[</span><span class="n">varname</span> <span class="o">+</span> <span class="s2">&quot;_annualavg&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)[</span><span class="n">varname</span><span class="p">]</span>

                        <span class="k">if</span> <span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;checked&#39;</span><span class="p">][</span><span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;currwrite&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
                            <span class="k">if</span> <span class="nb">map</span><span class="p">[</span><span class="o">-</span><span class="mi">9</span><span class="p">:]</span> <span class="o">==</span> <span class="s2">&quot;annualtot&quot;</span><span class="p">:</span>
                                    <span class="n">outMap</span><span class="p">[</span><span class="nb">map</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">writenetcdf</span><span class="p">(</span><span class="n">netfile</span><span class="p">,</span> <span class="n">varname</span><span class="p">,</span><span class="s2">&quot;_annualtot&quot;</span><span class="p">,</span> <span class="s2">&quot;undefined&quot;</span><span class="p">,</span> <span class="nb">eval</span><span class="p">(</span><span class="n">inputmap</span><span class="o">+</span> <span class="s2">&quot;_annualtot&quot;</span><span class="p">),</span> <span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;currDate&#39;</span><span class="p">],</span> <span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;currYear&#39;</span><span class="p">],</span> <span class="n">flag</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span>
                                                                    <span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;diffYear&#39;</span><span class="p">],</span> <span class="n">dateunit</span><span class="o">=</span><span class="s2">&quot;years&quot;</span><span class="p">)</span>
                            <span class="k">if</span> <span class="nb">map</span><span class="p">[</span><span class="o">-</span><span class="mi">9</span><span class="p">:]</span> <span class="o">==</span> <span class="s2">&quot;annualavg&quot;</span><span class="p">:</span>
                                        <span class="n">days</span> <span class="o">=</span> <span class="mi">366</span> <span class="k">if</span> <span class="n">calendar</span><span class="o">.</span><span class="n">isleap</span><span class="p">(</span><span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;currDate&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">year</span><span class="p">)</span> <span class="k">else</span> <span class="mi">365</span>
                                        <span class="n">avgmap</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)[</span><span class="n">varname</span> <span class="o">+</span> <span class="s2">&quot;_annualavg&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">days</span>
                                        <span class="n">outMap</span><span class="p">[</span><span class="nb">map</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">writenetcdf</span><span class="p">(</span><span class="n">netfile</span><span class="p">,</span> <span class="n">varname</span><span class="p">,</span><span class="s2">&quot;_annualavg&quot;</span><span class="p">,</span> <span class="s2">&quot;undefined&quot;</span><span class="p">,</span> <span class="n">avgmap</span><span class="p">,</span> <span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;currDate&#39;</span><span class="p">],</span> <span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;currYear&#39;</span><span class="p">],</span> <span class="n">flag</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span>
                                                                        <span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;diffYear&#39;</span><span class="p">],</span><span class="n">dateunit</span><span class="o">=</span><span class="s2">&quot;years&quot;</span><span class="p">)</span>
                                    <span class="c1">#vars(self.var)[varname+&quot;annualtot&quot;] = 0</span>


                        <span class="k">if</span> <span class="nb">map</span><span class="p">[</span><span class="o">-</span><span class="mi">8</span><span class="p">:]</span> <span class="o">==</span> <span class="s2">&quot;totaltot&quot;</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;curr&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;intSpin&#39;</span><span class="p">]:</span>
                                <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)[</span><span class="n">varname</span> <span class="o">+</span> <span class="s2">&quot;_totaltot&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)[</span><span class="n">varname</span> <span class="o">+</span> <span class="s2">&quot;_totaltot&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)[</span><span class="n">varname</span><span class="p">]</span>
                                <span class="k">if</span> <span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;currDate&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;dateEnd&#39;</span><span class="p">]:</span>
                                    <span class="c1"># at the end of simulation write this map</span>
                                    <span class="n">outMap</span><span class="p">[</span><span class="nb">map</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">writenetcdf</span><span class="p">(</span><span class="n">netfile</span><span class="p">,</span> <span class="n">varname</span><span class="p">,</span><span class="s2">&quot;_totaltot&quot;</span><span class="p">,</span> <span class="s2">&quot;undefined&quot;</span><span class="p">,</span> <span class="nb">eval</span><span class="p">(</span><span class="n">inputmap</span> <span class="o">+</span>  <span class="s2">&quot;_totaltot&quot;</span><span class="p">),</span>
                                                                <span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;currDate&#39;</span><span class="p">],</span> <span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;currwrite&#39;</span><span class="p">],</span> <span class="n">flag</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

                        <span class="k">if</span> <span class="nb">map</span><span class="p">[</span><span class="o">-</span><span class="mi">8</span><span class="p">:]</span> <span class="o">==</span> <span class="s2">&quot;totalavg&quot;</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;curr&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;intSpin&#39;</span><span class="p">]:</span>
                                <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)[</span><span class="n">varname</span> <span class="o">+</span> <span class="s2">&quot;_totalavg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)[</span><span class="n">varname</span> <span class="o">+</span> <span class="s2">&quot;_totalavg&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)[</span><span class="n">varname</span><span class="p">]</span><span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;diffdays&#39;</span><span class="p">])</span>
                                <span class="k">if</span> <span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;currDate&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;dateEnd&#39;</span><span class="p">]:</span>
                                    <span class="c1"># at the end of simulation write this map</span>
                                    <span class="n">outMap</span><span class="p">[</span><span class="nb">map</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">writenetcdf</span><span class="p">(</span><span class="n">netfile</span><span class="p">,</span> <span class="n">varname</span><span class="p">,</span><span class="s2">&quot;_totalavg&quot;</span><span class="p">,</span> <span class="s2">&quot;undefined&quot;</span><span class="p">,</span>
                                                                    <span class="nb">eval</span><span class="p">(</span><span class="n">inputmap</span> <span class="o">+</span> <span class="s2">&quot;_totalavg&quot;</span><span class="p">),</span>
                                                                    <span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;currDate&#39;</span><span class="p">],</span> <span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;currwrite&#39;</span><span class="p">],</span>
                                                                    <span class="n">flag</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

                        <span class="k">if</span> <span class="nb">map</span><span class="p">[</span><span class="o">-</span><span class="mi">8</span><span class="p">:]</span> <span class="o">==</span> <span class="s2">&quot;totalend&quot;</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;currDate&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;dateEnd&#39;</span><span class="p">]:</span>
                                <span class="c1"># at the end of simulation write this map</span>
                                <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)[</span><span class="n">varname</span> <span class="o">+</span> <span class="s2">&quot;_totalend&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)[</span><span class="n">varname</span><span class="p">]</span>
                                <span class="n">outMap</span><span class="p">[</span><span class="nb">map</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">writenetcdf</span><span class="p">(</span><span class="n">netfile</span><span class="p">,</span> <span class="n">varname</span><span class="p">,</span><span class="s2">&quot;_totalend&quot;</span><span class="p">,</span><span class="s2">&quot;undefined&quot;</span><span class="p">,</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)[</span><span class="n">varname</span><span class="p">],</span>
                                                                <span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;currDate&#39;</span><span class="p">],</span>
                                                                <span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;currwrite&#39;</span><span class="p">],</span>
                                                                <span class="n">flag</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>


                                <span class="c1"># ************************************************************</span>
        <span class="c1"># ***** WRITING RESULTS: TIME SERIES *************************</span>
        <span class="c1"># ************************************************************</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">firstout</span> <span class="o">=</span> <span class="n">firstout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">discharge</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">Flags</span><span class="p">[</span><span class="s1">&#39;loud&#39;</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r</span><span class="si">%-6i</span><span class="s2"> </span><span class="si">%10s</span><span class="s2"> </span><span class="si">%10.2f</span><span class="s2">     &quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;currStart&#39;</span><span class="p">],</span><span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;currDatestr&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">firstout</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">Flags</span><span class="p">[</span><span class="s1">&#39;check&#39;</span><span class="p">]):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">Flags</span><span class="p">[</span><span class="s1">&#39;quiet&#39;</span><span class="p">])</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span><span class="p">(</span><span class="n">Flags</span><span class="p">[</span><span class="s1">&#39;veryquiet&#39;</span><span class="p">])):</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="ow">not</span><span class="p">(</span><span class="n">Flags</span><span class="p">[</span><span class="s1">&#39;quiet&#39;</span><span class="p">]))</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span><span class="p">(</span><span class="n">Flags</span><span class="p">[</span><span class="s1">&#39;veryquiet&#39;</span><span class="p">])):</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r</span><span class="si">%d</span><span class="s2">   &quot;</span> <span class="o">%</span> <span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;currStart&#39;</span><span class="p">],</span><span class="n">end</span> <span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

        <span class="c1">#if Flags[&#39;loud&#39;] and checkOption(&#39;reportTss&#39;):</span>
            <span class="c1">#print(&quot; %10.2f&quot; % self.var.firstout)</span>

        <span class="k">if</span> <span class="n">checkOption</span><span class="p">(</span><span class="s1">&#39;reportTss&#39;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">tss</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">outTss</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">outTss</span><span class="p">[</span><span class="n">tss</span><span class="p">]</span><span class="o">.</span><span class="fm">__len__</span><span class="p">()):</span>
                    <span class="c1"># loop for each variable in a section</span>
                    <span class="k">if</span> <span class="n">outTss</span><span class="p">[</span><span class="n">tss</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;None&quot;</span><span class="p">:</span>
                        <span class="n">varname</span> <span class="o">=</span> <span class="n">outTss</span><span class="p">[</span><span class="n">tss</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">varnameCollect</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">varname</span><span class="p">)</span>
                        <span class="n">what</span> <span class="o">=</span> <span class="s1">&#39;self.var.&#39;</span> <span class="o">+</span> <span class="n">outTss</span><span class="p">[</span><span class="n">tss</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

                        <span class="c1"># to use also variables with index from soil e.g. actualET[2]</span>
                        <span class="k">if</span> <span class="s1">&#39;[&#39;</span> <span class="ow">in</span> <span class="n">varname</span><span class="p">:</span>
                            <span class="n">checkname</span> <span class="o">=</span> <span class="n">varname</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">varname</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;[&quot;</span><span class="p">)]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">checkname</span> <span class="o">=</span> <span class="n">varname</span>
                        <span class="n">checkifvariableexists</span><span class="p">(</span><span class="n">tss</span><span class="p">,</span> <span class="n">checkname</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>

                        <span class="k">if</span> <span class="n">tss</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:]</span> <span class="o">==</span> <span class="s2">&quot;daily&quot;</span><span class="p">:</span>
                            <span class="c1"># what = &#39;self.var.&#39; + reportTimeSerieAct[tss][&#39;outputVar&#39;][0]</span>
                            <span class="c1"># how = reportTimeSerieAct[outTss[tss][0][0]][&#39;operation&#39;][0]</span>
                            <span class="c1"># if how == &#39;mapmaximum&#39;:</span>
                            <span class="c1"># changed = compressArray(mapmaximum(decompress(eval(what))))</span>
                            <span class="c1"># what = &#39;changed&#39;</span>
                            <span class="c1"># if how == &#39;total&#39;:</span>
                            <span class="c1"># changed = compressArray(catchmenttotal(decompress(eval(what)) * self.var.PixelAreaPcr,self.var.Ldd) * self.var.InvUpArea)</span>
                            <span class="c1"># what = &#39;changed&#39;</span>
                            <span class="c1"># print i, outTss[tss][i][1], what</span>
                            <span class="c1">#outTss[tss][i][0].sample2(decompress(eval(what)), 0 )</span>
                            <span class="n">outTss</span><span class="p">[</span><span class="n">tss</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sample3</span><span class="p">(</span><span class="n">outTss</span><span class="p">[</span><span class="n">tss</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="nb">eval</span><span class="p">(</span><span class="n">what</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span>

                        <span class="k">if</span> <span class="n">tss</span><span class="p">[</span><span class="o">-</span><span class="mi">8</span><span class="p">:]</span> <span class="o">==</span> <span class="s2">&quot;monthend&quot;</span><span class="p">:</span>
                            <span class="c1"># reporting at the end of the month:</span>
                            <span class="n">outTss</span><span class="p">[</span><span class="n">tss</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sample3</span><span class="p">(</span><span class="n">outTss</span><span class="p">[</span><span class="n">tss</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="nb">eval</span><span class="p">(</span><span class="n">what</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>

                        <span class="k">if</span> <span class="n">tss</span><span class="p">[</span><span class="o">-</span><span class="mi">8</span><span class="p">:]</span> <span class="o">==</span> <span class="s2">&quot;monthtot&quot;</span><span class="p">:</span>
                            <span class="c1"># if  monthtot is not calculated it is done here</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">varname</span> <span class="o">+</span> <span class="s2">&quot;_monthtotTss&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">):</span>
                                <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)[</span><span class="n">varname</span> <span class="o">+</span> <span class="s2">&quot;_monthtotTss&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)[</span><span class="n">varname</span> <span class="o">+</span> <span class="s2">&quot;_monthtotTss&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)[</span><span class="n">varname</span><span class="p">]</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)[</span><span class="n">varname</span> <span class="o">+</span> <span class="s2">&quot;_monthtotTss&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)[</span><span class="n">varname</span><span class="p">]</span>
                            <span class="n">outTss</span><span class="p">[</span><span class="n">tss</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sample3</span><span class="p">(</span><span class="n">outTss</span><span class="p">[</span><span class="n">tss</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="nb">eval</span><span class="p">(</span><span class="n">what</span> <span class="o">+</span> <span class="s2">&quot;_monthtotTss&quot;</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>

                        <span class="k">if</span> <span class="n">tss</span><span class="p">[</span><span class="o">-</span><span class="mi">8</span><span class="p">:]</span> <span class="o">==</span> <span class="s2">&quot;monthavg&quot;</span><span class="p">:</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">varname</span> <span class="o">+</span> <span class="s2">&quot;_monthavgTss&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">):</span>
                                <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)[</span><span class="n">varname</span> <span class="o">+</span> <span class="s2">&quot;_monthavgTss&quot;</span><span class="p">]</span> <span class="o">=</span>  <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)[</span><span class="n">varname</span> <span class="o">+</span> <span class="s2">&quot;_monthavgTss&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)[</span><span class="n">varname</span><span class="p">]</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)[</span><span class="n">varname</span> <span class="o">+</span> <span class="s2">&quot;_monthavgTss&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                                <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)[</span><span class="n">varname</span> <span class="o">+</span> <span class="s2">&quot;_monthavgTss&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)[</span><span class="n">varname</span> <span class="o">+</span> <span class="s2">&quot;_monthavgTss&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)[</span><span class="n">varname</span><span class="p">]</span>
                            <span class="n">avgmap</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)[</span><span class="n">varname</span> <span class="o">+</span> <span class="s2">&quot;_monthavgTss&quot;</span><span class="p">]</span> <span class="o">/</span>  <span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;daysInMonth&#39;</span><span class="p">]</span>
                            <span class="n">outTss</span><span class="p">[</span><span class="n">tss</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sample3</span><span class="p">(</span><span class="n">outTss</span><span class="p">[</span><span class="n">tss</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">avgmap</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>




                        <span class="k">if</span> <span class="n">tss</span><span class="p">[</span><span class="o">-</span><span class="mi">9</span><span class="p">:]</span> <span class="o">==</span> <span class="s2">&quot;annualend&quot;</span><span class="p">:</span>
                            <span class="c1"># reporting at the end of the month:</span>
                            <span class="c1">#outTss[tss][i][0].sample2(decompress(eval(what)), 2)</span>
                            <span class="n">outTss</span><span class="p">[</span><span class="n">tss</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sample3</span><span class="p">(</span><span class="n">outTss</span><span class="p">[</span><span class="n">tss</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="nb">eval</span><span class="p">(</span><span class="n">what</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

                        <span class="k">if</span> <span class="n">tss</span><span class="p">[</span><span class="o">-</span><span class="mi">9</span><span class="p">:]</span> <span class="o">==</span> <span class="s2">&quot;annualtot&quot;</span><span class="p">:</span>

                            <span class="k">if</span> <span class="p">(</span><span class="n">varname</span> <span class="o">+</span> <span class="s2">&quot;_annualtotTss&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">):</span>
                                <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)[</span><span class="n">varname</span> <span class="o">+</span> <span class="s2">&quot;_annualtotTss&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)[</span><span class="n">varname</span> <span class="o">+</span> <span class="s2">&quot;_annualtotTss&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)[</span><span class="n">varname</span><span class="p">]</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)[</span><span class="n">varname</span> <span class="o">+</span> <span class="s2">&quot;_annualtotTss&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)[</span><span class="n">varname</span><span class="p">]</span>
                            <span class="n">outTss</span><span class="p">[</span><span class="n">tss</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sample3</span><span class="p">(</span><span class="n">outTss</span><span class="p">[</span><span class="n">tss</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="nb">eval</span><span class="p">(</span><span class="n">what</span> <span class="o">+</span> <span class="s2">&quot;_annualtotTss&quot;</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

                        <span class="k">if</span> <span class="n">tss</span><span class="p">[</span><span class="o">-</span><span class="mi">9</span><span class="p">:]</span> <span class="o">==</span> <span class="s2">&quot;annualavg&quot;</span><span class="p">:</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">varname</span> <span class="o">+</span> <span class="s2">&quot;_annualavgTss&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">):</span>
                                <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)[</span><span class="n">varname</span> <span class="o">+</span> <span class="s2">&quot;_annualavgTss&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)[</span><span class="n">varname</span> <span class="o">+</span> <span class="s2">&quot;_annualavgTss&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)[</span><span class="n">varname</span><span class="p">]</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)[</span><span class="n">varname</span> <span class="o">+</span> <span class="s2">&quot;_annualavgTss&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)[</span><span class="n">varname</span><span class="p">]</span>
                            <span class="n">avgmap</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)[</span><span class="n">varname</span> <span class="o">+</span> <span class="s2">&quot;_annualavgTss&quot;</span><span class="p">]</span> <span class="o">/</span><span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;daysInYear&#39;</span><span class="p">]</span>
                            <span class="c1">#outTss[tss][i][0].sample2(decompress(avgmap), 2)</span>
                            <span class="n">outTss</span><span class="p">[</span><span class="n">tss</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sample3</span><span class="p">(</span><span class="n">outTss</span><span class="p">[</span><span class="n">tss</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">avgmap</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

                        <span class="k">if</span> <span class="n">tss</span><span class="p">[</span><span class="o">-</span><span class="mi">8</span><span class="p">:]</span> <span class="o">==</span> <span class="s2">&quot;totaltot&quot;</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;curr&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;intSpin&#39;</span><span class="p">]:</span>
                                <span class="k">if</span> <span class="p">(</span><span class="n">varname</span> <span class="o">+</span> <span class="s2">&quot;_totaltotTss&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">):</span>
                                    <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)[</span><span class="n">varname</span> <span class="o">+</span> <span class="s2">&quot;_totaltotTss&quot;</span><span class="p">]</span> <span class="o">=</span>  <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)[</span><span class="n">varname</span> <span class="o">+</span> <span class="s2">&quot;_totaltotTss&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)[</span><span class="n">varname</span><span class="p">]</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)[</span><span class="n">varname</span> <span class="o">+</span> <span class="s2">&quot;_totaltotTss&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)[</span><span class="n">varname</span><span class="p">]</span>
                                <span class="k">if</span> <span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;currDate&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;dateEnd&#39;</span><span class="p">]:</span>
                                    <span class="c1">#outTss[tss][i] = sample_maptotxt(outTss[tss][i],  eval(what + &quot;_totaltotTss&quot;))</span>
                                    <span class="n">sample_maptotxt</span><span class="p">(</span><span class="n">outTss</span><span class="p">[</span><span class="n">tss</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="nb">eval</span><span class="p">(</span><span class="n">what</span> <span class="o">+</span> <span class="s2">&quot;_totaltotTss&quot;</span><span class="p">))</span>

                        <span class="k">if</span> <span class="n">tss</span><span class="p">[</span><span class="o">-</span><span class="mi">8</span><span class="p">:]</span> <span class="o">==</span> <span class="s2">&quot;totalavg&quot;</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;curr&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;intSpin&#39;</span><span class="p">]:</span>
                                <span class="k">if</span> <span class="p">(</span><span class="n">varname</span> <span class="o">+</span> <span class="s2">&quot;_totalavgTss&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">):</span>
                                    <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)[</span><span class="n">varname</span> <span class="o">+</span> <span class="s2">&quot;_totalavgTss&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)[</span><span class="n">varname</span> <span class="o">+</span> <span class="s2">&quot;_totalavgTss&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)[</span><span class="n">varname</span><span class="p">]</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;diffdays&#39;</span><span class="p">])</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)[</span><span class="n">varname</span> <span class="o">+</span> <span class="s2">&quot;_totalavgTss&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)[</span><span class="n">varname</span><span class="p">]</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;diffdays&#39;</span><span class="p">])</span>
                                <span class="k">if</span> <span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;currDate&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;dateEnd&#39;</span><span class="p">]:</span>
                                    <span class="c1">#outTss[tss][i] = sample_maptotxt(outTss[tss][i], eval(what + &quot;_totalavgTss&quot;))</span>
                                    <span class="n">sample_maptotxt</span><span class="p">(</span><span class="n">outTss</span><span class="p">[</span><span class="n">tss</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="nb">eval</span><span class="p">(</span><span class="n">what</span> <span class="o">+</span> <span class="s2">&quot;_totalavgTss&quot;</span><span class="p">))</span>

        <span class="c1"># if end of month is reached all monthly storage is set to 0</span>
        <span class="c1">#if not(varname is None):</span>
        <span class="k">for</span> <span class="n">varname</span> <span class="ow">in</span> <span class="n">varnameCollect</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;checked&#39;</span><span class="p">][</span><span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;currwrite&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">varname</span> <span class="o">+</span> <span class="s2">&quot;_monthtot&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">):</span>
                    <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)[</span><span class="n">varname</span> <span class="o">+</span> <span class="s2">&quot;_monthtot&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">varname</span> <span class="o">+</span> <span class="s2">&quot;_monthavg&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">):</span>
                    <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)[</span><span class="n">varname</span> <span class="o">+</span> <span class="s2">&quot;_monthavg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">varname</span> <span class="o">+</span> <span class="s2">&quot;_monthtotTss&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">):</span>
                    <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)[</span><span class="n">varname</span> <span class="o">+</span> <span class="s2">&quot;_monthtotTss&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">varname</span> <span class="o">+</span> <span class="s2">&quot;_monthavgTss&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">):</span>
                    <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)[</span><span class="n">varname</span> <span class="o">+</span> <span class="s2">&quot;_monthavgTss&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">if</span> <span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;checked&#39;</span><span class="p">][</span><span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;currwrite&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">varname</span> <span class="o">+</span> <span class="s2">&quot;_annualtot&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">):</span>
                    <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)[</span><span class="n">varname</span> <span class="o">+</span> <span class="s2">&quot;_annualtot&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">varname</span> <span class="o">+</span> <span class="s2">&quot;_annualavg&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">):</span>
                    <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)[</span><span class="n">varname</span> <span class="o">+</span> <span class="s2">&quot;_annualavg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">varname</span> <span class="o">+</span> <span class="s2">&quot;_annualtotTss&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">):</span>
                    <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)[</span><span class="n">varname</span> <span class="o">+</span> <span class="s2">&quot;_annualtotTss&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">noOutpoints</span><span class="p">):</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">varname</span> <span class="o">+</span> <span class="s2">&quot;_annualtotTss&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ii</span><span class="p">))</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">):</span>
                        <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)[</span><span class="n">varname</span> <span class="o">+</span> <span class="s2">&quot;_annualtotTss&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ii</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">varname</span> <span class="o">+</span> <span class="s2">&quot;_annualavgTss&quot;</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">):</span>
                    <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)[</span><span class="n">varname</span> <span class="o">+</span> <span class="s2">&quot;_annualavgTss&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span></div></div>

</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, IIASA Water Security.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>